INSTALL ZIP: C:\p\c++\patch\v14_patch_fix_setpulsewidth_compile.zip
TIME: 2026-02-23 00:17:50
TARGET_ROOT: C:\p\c++\vPlotterV1
DEST (DEST_SUBDIR): C:\p\c++\vPlotterV1
VERSION:  PATCH_ID: 
INSTALL_TXT: (none)
BACKUP_ENABLED: True
BACKUP_ZIP: C:\p\c++\backup\backup_vPlotterV1_vnone_none_20260223_001743.zip
PRECHECK: replace=1 add=0 total=1

--- DIFF (line numbers) src/main.cpp ---
HUNK old 332-345  new 332-360
- old:   335   server->on("/setPulseWidths", HTTP_POST, [](AsyncWebServerRequest* req) {
- old:   336     // Pulse width is fixed to 10us for stability. Parameters are ignored on purpose.
- old:   337     const int us = 10;
- old:   338     if (movement) movement->setPulseWidths(us, us);
- old:   339     prefs.putInt(PREF_KEY_PULSE_L, us);
- old:   340     prefs.putInt(PREF_KEY_PULSE_R, us);
- old:   341     req->send(200, "application/json", "{"ok":true,"leftUs":10,"rightUs":10}");
- old:   342   });}
+ new:   335 server->on("/setPulseWidths", HTTP_POST, [](AsyncWebServerRequest* req) {
+ new:   336   // Pulse width is hard-locked for stability (do not allow runtime changes via UI)
+ new:   337   const int l = 10;
+ new:   338   const int r = 10;
+ new:   339 
+ new:   340   prefs.putInt(PREF_KEY_PULSE_L, l);
+ new:   341   prefs.putInt(PREF_KEY_PULSE_R, r);
+ new:   342 
+ new:   343   if (movement) {
+ new:   344     movement->setPulseWidths(l, r);
+ new:   345   }
+ new:   346 
+ new:   347   WebLog::info(String("Pulse widths locked: left=") + l + "us right=" + r + "us");
+ new:   348 
+ new:   349   StaticJsonDocument<128> doc;
+ new:   350   doc["ok"] = true;
+ new:   351   doc["leftUs"] = l;
+ new:   352   doc["rightUs"] = r;
+ new:   353   String out;
+ new:   354   serializeJson(doc, out);
+ new:   355   req->send(200, "application/json; charset=utf-8", out);
+ new:   356 });
+ new:   357 }
HUNK old 953-962  new 968-976
- old:   956   const int storedPulseL = 10;
- old:   957   const int storedPulseR = 10;
- old:   958   // Pulse widths are fixed to 10us for stability.
- old:   959 int storedPenDown = prefs.getInt(PREF_KEY_PEN_DOWN, 80);
+ new:   971   int storedPulseL = prefs.getInt(PREF_KEY_PULSE_L, 5);
+ new:   972   int storedPulseR = prefs.getInt(PREF_KEY_PULSE_R, 5);
+ new:   973   int storedPenDown = prefs.getInt(PREF_KEY_PEN_DOWN, 80);

CHANGELOG: C:\p\c++\vPlotterV1\CHANGELOG_unknown_20260223_001750.md
INSTALL DONE
